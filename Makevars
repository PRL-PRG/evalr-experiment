# -*- mode: makefile -*-
PROJECT_BASE_DIR ?= $(CURDIR)
R_LIBS           ?= $(PROJECT_BASE_DIR)/library
CRAN_DIR         ?= $(PROJECT_BASE_DIR)/CRAN
R_DIR            ?= $(PROJECT_BASE_DIR)/R-dyntrace
CRAN_MIRROR      := https://cloud.r-project.org

# R package dependencies for libraries
DEPENDENCIES_TXT := dependencies.txt
DEPENDENCIES := devtools \
  digest \
  dplyr \
  fs \
  fst \
  lubridate \
  magrittr \
  optparse \
  pbapply \
  progress \
  purrr \
  readr \
  rjson \
  rmarkdown \
  stringr \
  tidyverse \
  tibble \
  tidyr \
  withr \
  pbapply

DOCKER_IMAGE_NAME            := prlprg/project-evalr
DOCKER_RSTUDIO_IMAGE_NAME    := fikovnik/rstudio:4.0.2
DOCKER_R_DYNTRACE_IMAGE_NAME := prlprg/r-dyntrace:r-4.0.2

SSH_IDENTITY_FILE := docker-image/id_rsa
SSH_CONTROL_FILE_PREFIX := $(CURDIR)/ssh-controlmaster-
SSH_LOGIN_FILE := ssh-login-file
SSH_HOST_PORT := 2222
SSH := ssh -o ControlPath=$(SSH_CONTROL_FILE_PREFIX)%r@%h:%p -F none -o LogLevel=ERROR -o "UserKnownHostsFile=/dev/null" -o "StrictHostKeyChecking=no" -p $(SSH_HOST_PORT) -l r -i $(SSH_IDENTITY_FILE) $(SSH_EXTRA)
SSH_NUM_SLOTS := 64

# all hosts
HOSTS := prl2 prl4
# slaves (excluding the one from which we run this make file)
SLAVES = $(filter-out $(HOSTNAME),$(HOSTS))

$(DEPENDENCIES_TXT):
	@echo $(DEPENDENCIES) | tr ' ' '\n' > $(DEPENDENCIES_TXT)
